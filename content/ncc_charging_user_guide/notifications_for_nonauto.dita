<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="id9yz-09126-ug01-pczza-sp1-d1e208069"><title>Notifications for non-auto charge and connectivity criteria </title><conbody>
<section><title>Overview</title>
<p>This feature provides information on notification for following cases:</p><ul>
<li>
<p>Devices are barred or unbarred based on certain connectivity criteria. </p>
</li>
<li>
<p>Volume Threshold (VT) notifications sent from threshold.</p>
</li>
<li>
<p>Expiry Threshold (ET) notifications sent from lifecycle.</p>
</li>
<li>
<p>AutoCharge (AC) custom data has the value disable. This indicates that the group has not subscribed to the auto-charge feature. </p>
</li>
<li>
<p>Provisioning interface make changes to the AV with Charging Service, AV with Charging Service and CAP, Bucket and Account.</p>
</li>
</ul>
<p>This feature is applicable only to Absolute from Start (AFS) or Absolute from End (AFE) threshold and does not work for percentage thresholds. That is, the provisioning gateway can trigger threshold actions only for AFS and AFE thresholds but not for percentage thresholds. </p>
</section>
<section><title>Bar and unbar notification</title>
<p>The subsequent blocks provide information on the bar and unbar notification cases.</p></section>
<section>
<p><b>Bar notification</b></p>
<p>Consider that a group has multiple devices associated and the group has not subscribed to the
                    auto-charge feature. In this case, when the group subscription is exhausted,
                    then the Aggregate View (AV) unused value is zero. NCC sends a notification to
                    the operator provisioning system with well-defined parameters to take further
                    action such as bar all the devices of group. The operator provisioning system
                    triggers the PGW to bar all the devices of a group. This is the bar notification
                    case for volume threshold. </p>
<p>Similarly, when a device lifecycle moves to a state which is barred from an unbarred state, NCC
                    sends a notification to the operator provisioning system with well-defined
                    parameters to take further action such as bar a single device in the group. The
                    barred notification is sent when the device moves to the barred state. This is
                    the bar notification case (expiry threshold) linked to the device lifecycle
                    state.</p>
</section>
    <section><title>Unbar notification</title>
<p>Consider that a group with exhausted subscription receives notification about the subscription
                    status and refills its subscription due to which the AV unused value is
                    increased to a non-zero value. NCC sends a notification to the operator
                    provisioning system with well-defined parameters to take further action if
                    absolute from start threshold is defined such as unbar all the devices of a
                    given group. This is the unbar notification case for volume threshold. </p>
<p>Similarly, when a device lifecycle moves to unbarred state from barred state, NCC sends a
                    notification with well-defined parameters to the operator provisioning system to
                    take further action. This is the unbar notification case (expiry threshold)
                    linked to the device lifecycle state.</p>
<p>Following are the important points related to bar and unbar cases:</p><ul>
<li>
<p>The notification variables are different for all the cases.</p>
</li>
<li>
<p>It is assumed that the CCR-T is sent by PGW for all active sessions of devices are barred.</p>
</li>
<li>
<p>It is assumed that the CCR-I is sent by PGW for all devices are unbarred.</p>
</li>
<li>
<p>The barring and unbarring is done by the operator provisioning system. NCC only sends
                            notification to the operator provisioning system.</p>
</li>
<li>
<p>A single notification is sent for each bar and unbar for group through threshold of AV with Charging Service, AV with Charging Service and CAP, bucket and account, that is sent to the operator provisioning system.</p>
</li>
</ul>
</section>
<section>
<p><b>Notification variables for bar/unbar - Threshold</b></p>
<p>The following table provides information on notification connectivity when sent from threshold. </p>
<table frame="all" pgwide="1" colsep="1" rowsep="1">
                    <tgroup cols="5">
                        <colspec colname="col1"/>
                        <colspec colname="col2"/>
                        <colspec colname="col3"/>
                        <colspec colname="COLSPEC0"/>
                        <colspec colname="COLSPEC1"/>
                        <thead>
                            <row>
                                <entry>
                                    <p>Parameter</p>
                                </entry>
                                <entry>
                                    <p>Description</p>
                                </entry>
                                <entry>
                                    <p>AV</p>
                                </entry>
                                <entry>
                                    <p>Bucket</p>
                                </entry>
                                <entry>
                                    <p>Account</p>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry> Subscriber CD </entry>
                                <entry> This variable can be sent with the value of custom data
                                    available on Group/Device. This custom data can be created and
                                    set by the operator provisioning system. </entry>
                                <entry> Custom-Data (Owner DeviceId) on group/device level </entry>
                                <entry> Custom-Data (Owner DeviceId) on group/device level </entry>
                                <entry> Custom-Data (Owner DeviceId) on group level </entry>
                            </row>
                            <row>
                                <entry> Share ID </entry>
                                <entry> The Group Id/Device Id of the AV/bucket. </entry>
                                <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                                <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                                <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                            </row>
                            <row>
                                <entry> Remaining data volume </entry>
                                <entry> The current value. In barred case, the value is 0, for
                                    unbarred case, the value is non-zero. </entry>
                                <entry>
                                    <p>THRESHOLD_PROFILE.AV-Current-Value</p>
                                    <p>THRESHOLD_PROFILE.AV-Unused-Value</p>
                                </entry>
                                <entry>
                                    <p>THRESHOLD_PROFILE.Bucket-Current-Value</p>
                                    <p>THRESHOLD_PROFILE.Bucket-Unused-Value</p>
                                </entry>
                                <entry>
                                    <p>THRESHOLD_PROFILE.Account-Current-Value</p>
                                    <p>THRESHOLD_PROFILE.Account-Unused-Value</p>
                                </entry>
                            </row>
                            <row>
                                <entry> IMSI </entry>
                                <entry> This is not sent by NCC. </entry>
                                <entry> SPR_DEVICE.IMSI </entry>
                                <entry> SPR_DEVICE.IMSI </entry>
                                <entry> SPR_DEVICE.IMSI </entry>
                            </row>
                            <row>
                                <entry> Line Status </entry>
                                <entry> This is not sent by NCC. </entry>
                                <entry> - </entry>
                                <entry> - </entry>
                                <entry> - </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
</section>
    <section><title>Notification variables for bar/unbar - Lifecycle</title>
<p>The following table provides information on notification connectivity when sent from lifecycle of device. </p>
<table pgwide="1" colsep="1" rowsep="1">
                    <tgroup cols="3">
                        <colspec colname="col1"/>
                        <colspec colname="col2"/>
                        <colspec colname="col3"/>
                        <thead>
                            <row>
                                <entry>
                                    <p>Parameter</p>
                                </entry>
                                <entry>
                                    <p>Description</p>
                                </entry>
                                <entry>
                                    <p>Example</p>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry> Subscriber CD </entry>
                                <entry> The custom data <i>DeviceID</i> attached to the first group
                                    fetched from device. If Custom Data is not present in first
                                    group, the value of this variable is null. </entry>
                                <entry> SPR_GROUP.DeviceID </entry>
                            </row>
                            <row>
                                <entry> Share ID </entry>
                                <entry> The Group Id of the first group fetched from device. </entry>
                                <entry> SPR_GROUP-Group-Id </entry>
                            </row>
                            <row>
                                <entry> IMSI </entry>
                                <entry> This variable is set by NCC with the IMSI of a device.
                                    Device must be configured with IMSI as one of the identifier. </entry>
                                <entry> SPR_DEVICE.IMSI </entry>
                            </row>
                            <row>
                                <entry> Line Status </entry>
                                <entry>
                                    <p>This variable can be filled with a static value.</p>
                                    <p>NCC provides the Device lifecycle status (old and new state)
                                        and validity time (if available with that state) as a
                                        notification variable. </p>
                                    <p>Example: Device lifecycle transitions from State A to State
                                        B, with action <i>Send Notification</i> action. NCC sends
                                        State A and State B validity time and State A and State B
                                        name.</p>
                                </entry>
                                <entry>
                                    <p>LIFECYCLE.From-State</p>
                                    <p>LIFECYCLE.To-State</p>
                                    <p>LIFECYCLE.Old-Validity-Time</p>
                                    <p>LIFECYCLE.Next-Validity-Time</p>
                                </entry>
                            </row>
                            <row>
                                <entry> Remaining data volume </entry>
                                <entry>This variable is not sent by NCC.</entry>
                                <entry> - </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
</section>
    <section id="isbar"><title>Example: Threshold actions of AFE 0 is triggered when a subscription is removed and AFS 0 is triggered when another subscription is added to group</title>
<p><b></b></p>
<p>Here, AFE is Absolute from End and AFS is Absolute from Start. Note that the threshold action associated with the percentage based thresholds are not triggered from provisioning gateway.</p>
<p>
<uicontrol>Prerequisite:</uicontrol>
</p><ol>
<li>
<p>Create a threshold profile group TPG1 with TP1 value 0 AFS having the <i>Send Notification</i> action. Create another threshold profile group TPG2 with TP2 value 0 AFE having <i>Send Notification</i> action. AFS is shown in the following figure:</p>
<!--MMO resource relative URI: ../Graphics/Release_19.3/MOD170_AFS_default.png-->
<image href="../images/img9yz-09126-ug01-pczza-sp1-mod170_afs_default.png"/>
<p>AFE is shown in the following figure:</p>
<!--MMO resource relative URI: ../Graphics/Release_19.3/MOD170_AFE_default.png-->
<image href="../images/img9yz-09126-ug01-pczza-sp1-mod170_afe_default.png"/>
</li>
<li>
<p>Ensure that you have created group, subscription, and notification profile.</p>
</li>
<li>
<p>Create an AV of type volume having TPG1 and TPG2 and accumulating charging service attached to group G1.</p>
</li>
<li>
<p>The Group G1 has subscriptions such that sub1 has a bucket with value of 100 bytes.</p>
</li>
</ol>
<p>Perform the following actions:</p><ol>
<li>
<p>Remove the subscription sub1.</p>
</li>
<li>
<p>Add another subscription to group.</p>
</li>
</ol>
<p>Following is the result of the actions performed:</p><ol>
<li>
<p>The <userinput>Send-notification</userinput> actions of AFE 0 is triggered when the subscription sub1 is removed.</p>
</li>
<li>
<p>The <userinput>Send-notification</userinput> actions of AFS 0 is triggered when a subscription is added.</p>
</li>
</ol>
</section>
<section><title>Volume threshold notification variables</title>
<p>The following notification variables for Volume threshold notification are supported for all type of AVs, counter, bucket, account related notifications. These notification variables are applicable for threshold on group as well as device resources.</p>
<note type="attention">
<p>The notification variables listed in the subsequent tables are sample variables only and you can create custom variables based on your requirement.</p>
<p>For more variables, see <!--xref URI: #genericnotif--><xref keyref="id9YZ-09126-UG01-PCZZA-SP1-genericnotif"/>.</p>
</note>
<table pgwide="1" colsep="1" rowsep="1">
                <tgroup cols="3">
                    <colspec colname="col1"/>
                    <colspec colname="col2"/>
                    <colspec colname="COLSPEC9"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Parameter</p>
                            </entry>
                            <entry>
                                <p>Description</p>
                            </entry>
                            <entry>
                                <p>Applicable for resources</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Subscriber CD </entry>
                            <entry>
                                <p>This variable is the custom data available on Group/Device. This
                                    custom data can be created and set by the operator provisioning
                                    system. </p>
                                <p>For notification through THR, it can also be filled, if needed,
                                    with the DeviceId of that subscriber whose call has made the THR
                                    to reach.</p>
                            </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Share ID </entry>
                            <entry> The Group Id/Device Id. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Remaining data volume </entry>
                            <entry> The current value. Notification variables can be made available
                                for both type of current value, that is, with and without
                                reservation. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Original data volume </entry>
                            <entry> This variable is filled with a static value. NCC provides
                                notification variables which is sum of initial values of each
                                resource being accumulated for AV. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Threshold Type </entry>
                            <entry> This variable is filled with a static value. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Threshold </entry>
                            <entry> This variable is filled with a static value. NCC provides
                                notification variable for threshold value. This is also applicable
                                when the threshold is on individual bucket, counter, and account. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the line </entry>
                            <entry> This variable is filled with a static value. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the purchased data volume </entry>
                            <entry> This variable is filled with a static value or it can be mapped
                                to a custom data. </entry>
                            <entry> AV (all types), Bucket, Counter, Account </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<table pgwide="1" colsep="1" rowsep="1">
                <title>AV threshold notification variables </title>
                <tgroup cols="2">
                    <colspec colname="col1"/>
                    <colspec colname="col3"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Parameter</p>
                            </entry>
                            <entry>
                                <p>Example</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Subscriber CD </entry>
                            <entry> Custom-Data </entry>
                        </row>
                        <row>
                            <entry> Share ID </entry>
                            <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                        </row>
                        <row>
                            <entry> Remaining data volume </entry>
                            <entry>
                                <p>THRESHOLD_PROFILE.AV-Current-Value</p>
                                <p>THRESHOLD_PROFILE.AV-Unused-Value</p>
                            </entry>
                        </row>
                        <row>
                            <entry> Original data volume </entry>
                            <entry> THRESHOLD_PROFILE.AV-Initial-Value </entry>
                        </row>
                        <row>
                            <entry> Threshold Type </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Threshold </entry>
                            <entry> THRESHOLD_PROFILE.Threshold-Value ( "ThresholdName" ) </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the line </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the purchased data volume </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<table pgwide="1" colsep="1" rowsep="1">
                <title>Account threshold notification variables </title>
                <tgroup cols="2">
                    <colspec colname="col1"/>
                    <colspec colname="col3"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Parameter</p>
                            </entry>
                            <entry>
                                <p>Example</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Subscriber CD </entry>
                            <entry> Custom-Data </entry>
                        </row>
                        <row>
                            <entry> Share ID </entry>
                            <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                        </row>
                        <row>
                            <entry> Remaining data volume </entry>
                            <entry>
                                <p>THRESHOLD_PROFILE.Account-Current-Value</p>
                                <p>THRESHOLD_PROFILE.Account-Unused-Value</p>
                            </entry>
                        </row>
                        <row>
                            <entry> Original data volume </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Threshold Type </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Threshold </entry>
                            <entry> THRESHOLD_PROFILE.Threshold-Value ( "ThresholdName" ) </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the line </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the purchased data volume </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<table frame="all" pgwide="1" colsep="1" rowsep="1">
                <title>Bucket threshold notification variables </title>
                <tgroup cols="2">
                    <colspec colname="col1"/>
                    <colspec colname="col3"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Parameter</p>
                            </entry>
                            <entry>
                                <p>Example</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Subscriber CD </entry>
                            <entry> Custom-Data </entry>
                        </row>
                        <row>
                            <entry> Share ID </entry>
                            <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                        </row>
                        <row>
                            <entry> Remaining data volume </entry>
                            <entry>
                                <p>THRESHOLD_PROFILE.Bucket-Current-Value</p>
                                <p>THRESHOLD_PROFILE.Bucket-Unused-Value</p>
                            </entry>
                        </row>
                        <row>
                            <entry> Original data volume </entry>
                            <entry> THRESHOLD_PROFILE.Bucket-Initial-Value </entry>
                        </row>
                        <row>
                            <entry> Threshold Type </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Threshold </entry>
                            <entry> THRESHOLD_PROFILE.Threshold-Value ( "ThresholdName" ) </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the line </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the purchased data volume </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<table frame="all" pgwide="1" colsep="1" rowsep="1">
                <title>Counter threshold notification variables </title>
                <tgroup cols="2">
                    <colspec colname="col1"/>
                    <colspec colname="col3"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Parameter</p>
                            </entry>
                            <entry>
                                <p>Example</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Subscriber CD </entry>
                            <entry> Custom-Data </entry>
                        </row>
                        <row>
                            <entry> Share ID </entry>
                            <entry> SPR_GROUP.Group-Id/SPR_DEVICE.Device-Id </entry>
                        </row>
                        <row>
                            <entry> Remaining data volume </entry>
                            <entry> THRESHOLD_PROFILE.Counter-Current-Value </entry>
                        </row>
                        <row>
                            <entry> Original data volume </entry>
                            <entry> Custom-Data/Static/0 </entry>
                        </row>
                        <row>
                            <entry> Threshold Type </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Threshold </entry>
                            <entry> THRESHOLD_PROFILE.Threshold-Value ( "ThresholdName" ) </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the line </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the purchased data volume </entry>
                            <entry> Custom-Data/Static </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<sectiondiv>
<p><b>Example: VT notification for bucket with normal and CO instances</b></p>
<p>Auto-charge feature is turned off on group. Create the group and subscribe the bundle. Create device and add it to the group. Create the custom data - <userinput>ExpiryDataLine</userinput> and <userinput>ExpiryDataPurchasedDataVolume</userinput> for the group. Create the account, threshold, Charging Service, and Bundle. In the bundle, define a bucket with volume data of 300 byte. In the threshold profile, define AFS = 20. The VT notifications are sent based on the variables defined in the threshold profile as shown in the following figure.</p>
<fig>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/VT_Notification_default.png-->
                    <image href="../images/img9yz-09126-ug01-pczza-sp1-vt_notification_default.png"
                        scale="70"/>
                </fig>
</sectiondiv>
</section>
<section><title>Subscription expiry notification variables</title>
<p>The notification variables in the following table are applicable for the variables being created in the lifecycle of subscription from group as well as device.</p>
<p>The <userinput>SPR_GROUP</userinput> and <userinput>SPR_DEVICE</userinput> source context are available in the lifecycle for <uicontrol>Send-Notification</uicontrol> action only. These source context are provided in rules in lifecycle which means the custom data and other attributes of Group and Device can be used in rules as notification variables. If the subscription is attached to group, then <userinput>SPR_GROUP</userinput> context is available in the rule of lifecycle for the <uicontrol>Send-Notification</uicontrol> action. Similarly, when a subscription is attached to the device, <userinput>SPR_DEVICE</userinput> source context is available in the rule of lifecycle for the <uicontrol>Send-Notification</uicontrol> action</p>
<p>Notification variables for date of entity and periodic lifecycle of subscription are available. That is, for the subscription, the validity date is in entity lifecycle and end date in periodic lifecycle are available which can be used in rules with notification variables. When a notification is sent to end user using lifecycle, then the validity of their subscription can be informed.</p>
<note type="attention">
<p>The notification variables listed in the subsequent table are sample variables only and you can create custom variables based on your requirement.</p>
<p>For more variables, see <xref href="genericnotif.dita"/>.</p>
</note>
<table pgwide="1" colsep="1" rowsep="1">
                <tgroup cols="4">
                    <colspec colname="col1"/>
                    <colspec colname="col2"/>
                    <colspec colname="COLSPEC3"/>
                    <colspec colname="COLSPEC4"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Parameter</p>
                            </entry>
                            <entry>
                                <p>Description</p>
                            </entry>
                            <entry>
                                <p>Behavior for Group subscription</p>
                            </entry>
                            <entry>
                                <p>Behavior for Device subscription</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry> Subscriber CD </entry>
                            <entry> This variable can be sent with the value of custom data
                                available on Group. This custom data can be created and set by the
                                operator provisioning system. </entry>
                            <entry>
                                <p>SPR_GROUP.Device-Id</p>
                                <p>Custom Data</p>
                            </entry>
                            <entry>
                                <p>SPR_DEVICE.Group-Id</p>
                                <p>Custom Data</p>
                            </entry>
                        </row>
                        <row>
                            <entry> Share ID </entry>
                            <entry> The Group Id of the subscription. </entry>
                            <entry> SPR_GROUP.Group-Id </entry>
                            <entry> SPR_DEVICE.Device-Id </entry>
                        </row>
                        <row>
                            <entry> Remaining data volume </entry>
                            <entry> This variable is not sent by NCC. It can be set to Null in
                                notification template in NS or can be sent as a static value by
                                charging or can be sent from any of the custom data at group. </entry>
                            <entry> Static/NULL </entry>
                            <entry> Static/NULL </entry>
                        </row>
                        <row>
                            <entry> Original data volume </entry>
                            <entry> This variable is filled with a static value. </entry>
                            <entry> Static value </entry>
                            <entry> Static value </entry>
                        </row>
                        <row>
                            <entry> Threshold Type </entry>
                            <entry> This variable is filled with a static value. </entry>
                            <entry> Static data </entry>
                            <entry> Static data </entry>
                        </row>
                        <row>
                            <entry> Threshold </entry>
                            <entry> This variable is filled with a static value. </entry>
                            <entry> Static </entry>
                            <entry> Static </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the line </entry>
                            <entry> This variable is filled with a static value. </entry>
                            <entry> Static data </entry>
                            <entry> Static data </entry>
                        </row>
                        <row>
                            <entry> Expiry date of the purchased data volume </entry>
                            <entry> This is set to the expiry date of the group subscription. The
                                end time of entity and periodic lifecycle of subscription,
                                subscription creation time, can be made available as notification
                                variable. </entry>
                            <entry>
                                <p>
                                    <uicontrol>For entity lifecycle:</uicontrol>
                                </p>
                                <ul>
                                    <li>
                                        <p>SUBSCRIPTION.Creation-Time</p>
                                    </li>
                                    <li>
                                        <p>LIFECYCLE.Old-Validity-Time</p>
                                    </li>
                                    <li>
                                        <p>LIFECYCLE.Next-ValidityTime</p>
                                    </li>
                                </ul>
                                <p>
                                    <uicontrol>For periodic lifecycle:</uicontrol>
                                </p>
                                <ul>
                                    <li>
                                        <p>SUBSCRIPTION.Creation-Time</p>
                                    </li>
                                    <li>
                                        <p>SUBSCRIPTION.Start-Time</p>
                                    </li>
                                    <li>
                                        <p>SUBSCRIPTION.End-Time</p>
                                    </li>
                                    <li>
                                        <p>LIFECYCLE.Old-Validity-Time</p>
                                    </li>
                                </ul>
                            </entry>
                            <entry>
                                <p>
                                    <uicontrol>For entity lifecycle:</uicontrol>
                                </p>
                                <ul>
                                    <li>
                                        <p>SUBSCRIPTION.Creation-Time</p>
                                    </li>
                                    <li>
                                        <p>LIFECYCLE.Old-Validity-Time</p>
                                    </li>
                                    <li>
                                        <p>LIFECYCLE.Next-ValidityTime</p>
                                    </li>
                                </ul>
                                <p>
                                    <uicontrol>For periodic lifecycle:</uicontrol>
                                </p>
                                <ul>
                                    <li>
                                        <p>SUBSCRIPTION.Creation-Time</p>
                                    </li>
                                    <li>
                                        <p>SUBSCRIPTION.Start-Time</p>
                                    </li>
                                    <li>
                                        <p>SUBSCRIPTION.End-Time</p>
                                    </li>
                                    <li>
                                        <p>LIFECYCLE.Old-Validity-Time</p>
                                    </li>
                                </ul>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<sectiondiv>
                <p><b>Example 1: Entity Lifecycle for Subscription expiry notification</b></p>
                <p>This example is designed to send notification using the Send Notification action.
                    Send Notification Action 1 sends Validity Time of Active state, that is, 28 days
                    timestamp as well as subscription creation time (see
                        <!--xref URI: #statepre--><xref
                        keyref="id9YZ-09126-UG01-PCZZA-SP1-d1e208069/statepre"/>). Send Notification
                    Action 2 sends Validity Time of Active State (28 days) as well as Validity Time
                    of Inactive state, that is, 2 days. Following is the generic transition from
                    StateA to StateB with Send Notification action.</p>
                <userinput>Transition -</userinput>
                <userinput>From: StateA</userinput>
                <userinput>To State: StateB</userinput>
                <userinput>Action: Send Notification Action</userinput>
                <p>The following parameters are used for ExpiryDataPurchasedDataVolume variable:</p><ul>
                    <li>
                        <p>StateA Validity Time</p>
                    </li>
                    <li>
                        <p>StateB Validity Time</p>
                    </li>
                    <li>
                        <p>Subscription Creation Time</p>
                    </li>
                </ul>
                <p>The subscription entity lifecycle has the preactive (Initial state), active,
                    inactive, deactive (Barred) states.</p><p>Following is the configuration made
                    for the group subscription entity lifecycle:</p>
                <fig>
                    <title>Entity lifecycle</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_EntityLC1_default.png-->
                    <image href="../images/img9yz-09126-ug01-pczza-sp1-bou_entitylc1_default.png"/>
                </fig>
                <p>The <uicontrol>preactive</uicontrol> state has the following event.</p>
                <fig id="statepre">
                    <title>Entity lifecycle - preactive state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_EntityLC2_default.png-->
                    <image href="../images/img9yz-09126-ug01-pczza-sp1-bou_entitylc2_default.png"
                        scale="65"/>
                </fig>
                <p>Following is the event in <uicontrol>active</uicontrol> state.</p>
                <fig id="stateact">
                    <title>Entity lifecycle - active state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_EntityLC6_default.png-->
                    <image href="../images/img9yz-09126-ug01-pczza-sp1-bou_entitylc6_default.png"
                        scale="65"/>
                </fig>
                <p>Following is the event in <uicontrol>inactive</uicontrol> state.</p>
                <fig>
                    <title>Entity lifecycle - inactive state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_EntityLC7_default.png-->
                    <image href="../images/img9yz-09126-ug01-pczza-sp1-bou_entitylc7_default.png"
                        scale="65"/>
                </fig>
                <p>Following is the event in <uicontrol>deactive</uicontrol> state.</p>
                <fig>
                    <title>Entity lifecycle - deactive state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_EntityLC8_default.png-->
                    <image href="../images/img9yz-09126-ug01-pczza-sp1-bou_entitylc8_default.png"/>
                </fig>
            </sectiondiv>
<sectiondiv>
<p><b>Example 2: Periodic Lifecycle for Subscription expiry notification</b></p>
<p>This example is designed to send notification using the Send Notification action. Send Notification Action 1, Send Notification Action 2, Send Notification Action 3 sends Subscription Start Time, Subscription End Time, and Subscription Entity Lifecycle current state Validity Time.</p>
<p>For periodic lifecycle, the following parameters are used for <i>ExpiryDataPurchasedDataVolume</i> variable:</p><ul>
<li>
<p>Subscription Start Time</p>
</li>
<li>
<p>Subscription End Time</p>
</li>
<li>
<p>Subscription Entity LifeCycle current state Validity Time</p>
</li>
</ul>
<p>Following is the configuration made for the group subscription periodic lifecycle:</p>
<fig>
                    <title>Periodic lifecycle</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_Sub_PeriodicLC1_default.png-->
                    <image
                        href="../images/img9yz-09126-ug01-pczza-sp1-bou_sub_periodiclc1_default.png"
                        scale="65"/>
                </fig>
<p>The <uicontrol>preactive</uicontrol> state transitions are as follows:</p>
<fig>
                    <title>Periodic lifecycle - preactive state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_Sub_PeriodicLC2_default.png-->
                    <image
                        href="../images/img9yz-09126-ug01-pczza-sp1-bou_sub_periodiclc2_default.png"
                        scale="65"/>
                </fig>
<p>The notification event along with the rule defined in the <uicontrol>active</uicontrol> state is as follows:</p>
<fig>
                    <title>Periodic lifecycle - active state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_Sub_PeriodicLC3_default.png-->
                    <image
                        href="../images/img9yz-09126-ug01-pczza-sp1-bou_sub_periodiclc3_default.png"
                        scale="65"/>
                </fig>
<p>The <uicontrol>notify</uicontrol> state is as follows:</p>
<fig>
                    <title>Periodic lifecycle - notify state</title>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_Sub_PeriodicLC4_default.png-->
                    <image
                        href="../images/img9yz-09126-ug01-pczza-sp1-bou_sub_periodiclc4_default.png"
                        scale="65"/>
                </fig>
<p>The <uicontrol>deactive</uicontrol> state is as follows:</p>
<fig>
<title>Periodic lifecycle - deactive state</title>
<!--MMO resource relative URI: ../Graphics/Release_19.3/BOU_EntityLC8_default.png-->
<image href="../images/img9yz-09126-ug01-pczza-sp1-bou_entitylc8_default.png"/>
</fig>
</sectiondiv>
</section>
<section><title>Notifications through northbound interface</title>
<p>NCC triggers notification when the northbound provisioning interface makes either of the
                following changes:</p><ul>
<li>
<p>AV with charging service</p>
</li>
<li>
<p>AV with charging service and cap, bucket, and account</p>
</li>
</ul>
<p>If a defined threshold is crossed when an AV is updated using the provisioning interface, then
                the notification action on the threshold of AV are executed. The threshold at zero
                is optional. However, if any threshold value is crossed and required configurations
                are done for that threshold, then NCC sends the configured notification action.</p>
<note>
<p>Only the <systemoutput>Send-Notification</systemoutput> action is considered and the remaining actions, if defined, are considered when the next CCR request is received. The notification action is considered when the update is made to the threshold of AV.</p>
</note>
<p>The threshold execution of threshold profile type <uicontrol>ABSOLUTE_FROM_ZERO</uicontrol> for account can be used at the time of provisioning. During provisioning, the <uicontrol>ABSOLUTE_FROM_ZERO</uicontrol> profile is considered irrespective of whether the account balance is increased or decreased. Only the send notification action of the threshold crossed is supported during provisioning. </p>
<p>The notification to end user is sent if the following conditions are met:</p><ul>
<li>
<p>The available balance becomes equal to the threshold value.</p>
</li>
<li>
<p>The notification action is <systemoutput>Send-Notification</systemoutput>.</p>
</li>
</ul>
<p>The following context variables can be used:</p>
<table pgwide="1" colsep="1" rowsep="1">
                <tgroup cols="2">
                    <colspec colname="col1" colwidth="1*"/>
                    <colspec colname="col2" colwidth="1.11*"/>
                    <thead>
                        <row>
                            <entry>
                                <p>Context variable</p>
                            </entry>
                            <entry>
                                <p>Description</p>
                            </entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry>THRESHOLD.Threshold-Trigger-Type</entry>
                            <entry>This variable can be configured in result action, when you want
                                to execute the actions only during provisioning. If this action is
                                not defined, then THRESHOLD_TRIGGER_TYPE is treated as Diameter and
                                the send notification action does not get executed during
                                provisioning time.</entry>
                        </row>
                        <row>
                            <entry>THRESHOLD_PROFILE.Is-Balance-Increased</entry>
                            <entry>
                                <p>This variable can be used in a condition. During provisioning,
                                    there can be following scenarios:</p>
                                <ul>
                                    <li>
                                        <p>Increase balance using set/adjust API. For this scenario,
                                            the value of flag must be true.</p>
                                    </li>
                                    <li>
                                        <p>Decrease balance using set/adjust API. For this scenario,
                                            the value of flag must be false.</p>
                                    </li>
                                </ul>
                            </entry>
                        </row>
                        <row>
                            <entry>THRESHOLD_PROFILE.Is-Diameter-Call</entry>
                            <entry>This variable can be used in a condition. If the rule is executed
                                on a call, its value is true and for provisioning its value is
                                false.</entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
<p>Following are some points related to notification through north bound interface:</p><ul>
<li>
<p>Whenever AV/bucket is filled, then the Absolute From Start (ABS) Thresholds get triggered and whenever AV/bucket is being decremented, the Absolute From End gets executed. During provisioning, the behavior of ABS is different when compared to the Diameter call since during provisioning, ABS is triggered when AV/bucket is being filled whereas in Diameter call, the ABS is being triggered based on consumption from AV/bucket. </p>
</li>
<li>
<p>Reservation is not restricted even after sending bar notification through threshold.</p>
</li>
<li>
<p>Lifecycle AV/bucket update is treated as provisioning request.</p>
</li>
<li>
<p>For receiving bar/unbar notification, the required configuration is done on either all thresholds or chosen thresholds.</p>
</li>
<li>
<p>Whenever AV/Bucket is incremented or decremented, then ABS and ABE executes respectively and only <i>Send Notification</i> action is triggered. Rest of the actions are handled in upcoming Diameter call and same <i>Send Notification</i> action is not executed in upcoming Diameter call.</p>
</li>
<li>
<p>Only the device or group custom data attribute can be taken to handle the Device/Group Bar/Unbar notification. </p>
</li>
<li>
<p>The <i>Threshold-Trigger-Type</i> is used for configuration in threshold rules to differentiate between provisioning and Diameter call. The supported values are PROVISION or DIAMETER.</p>
</li>
<li>
<p>The <i>Threshold_Profile.Is-Diameter-Call</i> variable can be used in threshold to handle online or offline notification as well as handling of remaining actions of threshold in a Diameter call.</p>
</li>
<li>
<p>If multiple actions are being configured on a single Threshold with one of the Action as
                            <codeph>Send Notification Action</codeph>, then <codeph>Send
                            Notification Action</codeph> gets triggered from provisioning. And out
                        of remaining actions, if any action has higher priority than <codeph>Send
                            Notification Action</codeph>, then that action is executed during
                        upcoming Diameter call. But if none of the action out of remaining actions
                        has higher priority than <codeph>Send Notification Action</codeph>, then no
                        Action gets executed during upcoming Diameter call. Priority of Threshold
                        Actions -</p>
<p>
<codeph>Reject&gt;Notification-Reject&gt;Notification-Stop&gt;Send-Notification&gt;Notification-Continue&gt;Send-RAR</codeph>
</p>
</li>
<li>
<p>Only <systemoutput>Send Notification</systemoutput> action of threshold is triggered through provisioning.</p>
</li>
<li>
<p>If the <systemoutput>Send Notification</systemoutput> has been triggered through provisioning for AFS, and same threshold is being crossed during upcoming Diameter call, then send notification action is not suppressed in Diameter call. This is because, the AFS has different behavior for call and provisioning, whereas this notification is suppressed in case of AFE.</p>
</li>
<li>
<p>If AV is created during runtime, then rules or thresholds do not get evaluated since rules or thresholds are evaluated only during update</p>
</li>
<li>
<p>A custom data attribute, for example, <i>SPR_GROUP.IsBar</i>, a sample shown in <xref
                            href="#id9yz-09126-ug01-pczza-sp1-d1e208069/isbar" format="dita"/>, can
                        be taken to handle Device/Group Bar/Unbar notification. </p>
</li>
<li>
<p>Triggering threshold through provisioning interface is applicable only for Thresholds and not CAP.</p>
</li>
</ul>
<sectiondiv>
<p><b>Examples:</b></p>
<p>
<uicontrol>Example 1</uicontrol>
</p>
<p>AV initial value = 0</p>
<p>AV current value = 0</p>
<p>AV unused value = 0</p>
<p>TPG1 - Absolute from start</p>
<p>T1 = 100, T2 = 200, T3 = 300, T4 = 400</p>
<p>A subscription is added, initial = current = unused = 90. AV initial = current = unused = 90. As the AV unused value has incremented, the threshold from list of Absolute from start thresholds is T1 = 100. As no threshold is reached, so the <systemoutput>Send Notification</systemoutput> action is not triggered. Therefore, as per the configuration, if no threshold is crossed then notification is not sent.</p>
<p>
<uicontrol>Example 2</uicontrol>
</p>
<p>AV initial value = 100</p>
<p>AV current value = 50</p>
<p>AV unused value = 50</p>
<p>TPG1 - Absolute from end</p>
<p>T1 = 0, T2 = 10, T3 = 20, T4 = 30</p>
<p>Remove the subscription, initial = 50, current = 50, unused = 50. AV initial = 50, current = 0, unused =0. Since the AV unused value has decremented, only Absolute from end thresholds are considered.</p>
<p>It depends completely on provisioning that on which threshold of Absolute from end, you want to send bar notification. The rule gets called on AV unused value. If the rule to send bar notification action is configured on threshold <varname>T1</varname>, then rule is as follows:</p>
<fig>
<codeblock>if SPR_GROUP.custom_data.Barred = false and 
THRESHOLD_PROFILE.Is-Diameter-Call = false 
then 
THRESHOLD.Threshold-Trigger-Type = ThresholdTriggerType_PROVISION // attribute set in result context, Actions will be triggered only if rules are evaluated using Provisioning interface / North bound
and 
Then send barred notification and 
SPR_GROUP.custom_data.Barred = true
else
SPR_GROUP.custom_data.Barred = false and 
THRESHOLD_PROFILE.Is-Diameter-Call = true
Then send barred notification and
SPR_GROUP.custom_data.Barred = true</codeblock>
</fig>
<p>Therefore, the bar notification is sent on threshold value 0 of Absolute from end.</p>
<p>
<uicontrol>Example 3: Notification sent using threshold on account when an account balance is updated through Diameter or provisioning call </uicontrol>
</p>
<p>Consider the following values:</p>
<codeblock>Account Initial Balance = 50 units</codeblock>
<codeblock>TPG: Absolute from Zero</codeblock>
<codeblock>TH1 = 10, TH2 = 40</codeblock>
<p>
<uicontrol>Provisioning case:</uicontrol>
</p>
<p>Consider that the account is provisioned by setting the account balance to 30 units.</p>
<p>When the balance is decreased from 50 to 30 units, the threshold rule is evaluated with account available balance and the threshold action of TH2 is executed. </p>
<p>To send the notification for balance decreased by provisioning, the following rules must be configured for TH1 and TH2. Note that you can configure the <uicontrol>ABSOLUTE_FROM_ZERO</uicontrol> profile only for <uicontrol>Kind of Unit = Money</uicontrol>. </p>
<fig>
                    <!--MMO resource relative URI: ../Graphics/Release_19.3/MOD_170_TriggerType_default.png-->
                    <image
                        href="../images/img9yz-09126-ug01-pczza-sp1-mod_170_triggertype_default.png"
                        scale="80"/>
                </fig>
<p>Here, the else condition, that is, <codeph>Is-Diameter-Call = False</codeph> gets executed. The
                    notification is sent to the end user and the action reject is not executed at
                    the provisioning time.</p>
<p>
<uicontrol>Diameter call case:</uicontrol>
</p>
<p>Consider the following values:</p>
<codeblock>Account Initial Balance = 50 units</codeblock>
<codeblock>TPG: Absolute from Zero</codeblock>
<codeblock>TH1 = 10, TH2 = 40</codeblock>
<p>Assume that the balance gets reduced to 15 units. The threshold rule is evaluated with the
                    account available balance and the remaining threshold action of TH2 is executed.
                    Here, the remaining else condition is executed. In this case, the notification
                    is not sent. This is because, the notification has already been sent during
                    provisioning and only the remaining actions , that is, <codeph>Reject</codeph>
                    gets executed.</p>
</sectiondiv>
</section>
</conbody></concept>
