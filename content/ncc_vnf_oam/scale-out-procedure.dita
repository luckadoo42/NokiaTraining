<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA General Task//EN" "generalTask.dtd">
<task id="id9YZ-09126-MT00-REZZA-SP2-Scale-out-procedure"><title>Procedure: Scaling out a VNF manually</title>
    <taskbody id="d1e69015"><context>This procedure provides instructions on how to increase or scale out the number of VMs of a
            chosen VM type using the scale operation in CBAM. Scaling out a VNF can also be called
            horizontal scaling. This procedure applies to OpenStack and VMware deployments.<p>The
                scale-out operation supports the following VM types:</p><ul id="ul_omn_l5s_wmb">
                <li>
                    <p>DiameterApp</p>
                </li>
                <li>
                    <p>CDR</p>
                </li>
                <li>
                    <p>ComSvc</p>
                </li>
                <li>
                    <p>SM App</p>
                </li>
                <li>
                    <p>DB</p>
                </li>
            </ul><note>Call loss might happen during the scale-out operation. However, this call
                loss will be minimal and the NCC will remain healthy.</note>
</context>
    
    <section id="Scale-out-VMs-with-Kafka-broker">
                <title>Scaling out ComSvc or SM App VMs</title>
                <p>ComSvc and SM App VMs are the VMs where Kafka broker resides. On ME and IG sites,
                    Kafka broker resides on ComSvc VMs. On SM sites, Kafka broker resides on SM App
                    VMs. If you are scaling out ComSvc or SM App VMs, ensure the following:</p>
                <ul>
                    <li>
                        <p>&lt;kafka/kafka_reassign_partitions_throttle_Bps&gt; is 50% of the total
                            bandwidth between the two VMs hosting Kafka broker.</p>
                    </li>
                    <li>
                        <p>&lt;kafka/kafka_enable_scale_reassign_partition&gt; is set to true.</p>
                    </li>
                </ul>
                <p>During scaling Kafka broker VMs reassign topic data to other VMs using network
                    bandwidth. The reassign partition parameters limit the use of network bandwidth.
                    If you need to modify &lt;kafka/kafka_reassign_partitions_throttle_Bps&gt;, use
                        <codeph>configure-kafka-partition-keys</codeph> tool. The higher the
                    bandwidth allocation is, the faster the reassignment operation completes.
                    However, Nokia recommends to set this parameter to 50% of the total bandwidth.
                    For information about this tool, see section
                        <!--xref URI: t-oam-tools-configure-Kafka-partition-keys.xml#configure-kafka-partition-keys-tool--><xref
                        keyref="id9YZ-09126-MT00-REZZA-SP2-configure-kafka-partition-keys-tool"/>
                    and for information about Kafka parameters, see section <i>VNF Extenstion
                        file</i> in the Installation and Upgrade Guide.</p>
            </section><section id="Additional-IPs">
                <title>Additional IP addresses</title>
                <p>If the NCC is deployed with static network, the number of external network IP
                    addresses is delimited. To successfully scale out a VNF, you might need to add
                    more IP addresses to the Scalable file. Use the procedure
                        <!--xref URI: t-oam-scaling-choosing-scalable-file.xml#Adding_IP_addresses--><xref
                        keyref="id9YZ-09126-MT00-REZZA-SP2-Adding_IP_addresses"/> to add more IP
                    addresses to the Scalable file.</p>
            </section>
        <section id="section_adm_xzt_wmb">
            <note>For more information on CBAM, see CloudBand Application Manager (CBAM)
                documentation in the Nokia Discovery Center by going to <xref format="html"
                    href="https://doc.networks.nokia.com" scope="external"
                    >https://doc.networks.nokia.com</xref></note>
            <p>Before beginning this procedure, ensure the following:</p>
            <ul id="ul_bdm_xzt_wmb">
                <li>
                    <p>If you are scaling out ComSvc or SM App VMs, Kafka parameters have proper
                        configurations. For more information, see
                            <!--xref URI: #Scale-out-VMs-with-Kafka-broker--><xref
                            keyref="id9YZ-09126-MT00-REZZA-SP2-Scale-out-procedure/Scale-out-VMs-with-Kafka-broker"
                        />.</p>
                </li>
                <li>
                    <p>In the VNF targeted for scale-out, all the VMs are UP and running.</p>
                </li>
                <li>
                    <p>You have a plan for capacity and performance increase for the proper new
                        target level in the scale-out operation.</p>
                </li>
                <li>
                    <p>The site that you are scaling out has been instantiated using CBAM.</p>
                </li>
                <li>
                    <p>The number of available IP addresses is sufficient to scale out the VNF.</p>
                </li>
                <li>
                    <p>Your cloud resources are sufficient to scale out the VNF.</p>
                </li>
            </ul>
        </section>
        <section id="section_cdm_xzt_wmb">
            <p>To manually scale out the VNF:</p>
        </section>
        <steps id="steps_ddm_xzt_wmb">
            <step>
                <cmd>Log in to the CBAM GUI.</cmd>
                <info/>
            </step>
            <step>
                <cmd>In the CBAM GUI, click the options button with three horizontal lines, and then
                    select <b>Virtualized Network Functions</b>. The <b>Virtualized Network
                        Functions</b> pane appears.</cmd>
                <info/>
            </step>
            <step>
                <cmd>In the Virtualized Network Functions pane, select the appropriate VNF and hover
                    the mouse over the right of the selected line, and then click the <b>Scale</b>
                    button represented by the double square. The <b>Aspect</b> pane appears.</cmd>
                <info/>
            </step>
            <step>
                <cmd>From the <b>Scaling Aspect</b> drop-down list, select the VM type to scale out.
                    Currently the supported choices are:</cmd>
                <info>
                    <ul id="ul_edm_xzt_wmb">
                        <li>
                            <p>for ME sites: COMSVCAspect, DiameterAppAspect, DBAspect,
                                CDRAspect</p>
                        </li>
                        <li>
                            <p>for SM sites: SMAppAspect, DBAspect</p>
                        </li>
                    </ul>
                    <p>Click <b>Continue</b>. The <b>Target Level</b> pane appears. </p>
                </info>
            </step>
            <step>
                <cmd>In the <b>New target level</b> field, set the new target level to the number of
                    units to which you are scaling out the selected VM type.</cmd>
                <info>
                    <note>
                        <p>The new target level must be greater than the current target level.</p>
                        <p>If you are scaling-out DBAspect, the new target level should be an even
                            number.</p>
                    </note>
                    <p>Click <b>Continue</b>. The <b>Additional Parameters</b> pane appears. </p>
                </info>
            </step>
            <step>
                <cmd>In the <b>Additional Parameters</b> pane, ensure the following:</cmd>
                <info>
                    <ul id="ul_fdm_xzt_wmb">
                        <li>
                            <p>The <b>ForceScaleIn</b> field is set to no.</p>
                        </li>
                        <li>
                            <p>The <b>VnfcNameToScaleIn</b> field stays blank.</p>
                        </li>
                    </ul>
                    <p>Click <b>Finish</b>.</p>
                    <p>
                        <b>Expected outcome</b>
                    </p>
                    <p>The <b>Scale</b> operation succeeds or not.</p>
                </info>
            </step>
            <step>
                <cmd>If the <b>Scale</b> operation does not succeed, refer to the CloudBand
                    Application Manager (CBAM) Troubleshooting documentation in the Nokia Discovery
                    Center by going to <xref format="html" href="https://doc.networks.nokia.com"
                        scope="external">https://doc.networks.nokia.com</xref>. The CBAM
                    Troubleshooting Guide contains a generic procedure for troubleshooting a failed
                    scale-out. Nokia Professional Services is also available.</cmd>
                <info/>
            </step>
        </steps>
</taskbody>
</task>
