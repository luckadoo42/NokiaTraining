<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="id9YZ-09126-MT00-REZZA-SP2-Manual-healing"><title>Procedure: Healing a VM manually</title><taskbody id="d1e71087"><context><sectiondiv>
				<p><b>Overview</b></p>
				<p>This procedure provides instructions on how to heal one or more VMs of a
					specified VM type in N+K or 1+1 VM cluster using CBAM as a VNF manager. If the
					number of VMs to heal is more than K, when the VM cluster is N+K, or 1, when the
					VM cluster is 1+1,  Disaster recovery should be used instead of this
					procedure.</p>
				<p>In this procedure, the VMs are healed one VM at a time and using rebuild or
					reboot as healing options:</p>
				<ul>
					<li>
						<p>When you choose rebuild, the VM is rebuilt with the same image that was
							used during the instantiation.</p>
					</li>
					<li>
						<p>When you choose reboot, the VM is rebooted.</p>
					</li>
				</ul>
				<note>
					<p>If manual healing is in progress, auto-healing does not start. If
						auto-healing is in process, the user cannot start manual healing. Only one
						type of healing is allowed at a time.</p>
				</note>
				<note>
					<p>If a particular VM repeatedly requires healing, contact your cloud
						administrator.</p>
				</note>
			</sectiondiv><note>
				<p>For more information on CBAM, see CloudBand Application Manager (CBAM)
					documentation in the Nokia Discovery Center by going to <xref format="html"
						href="https://doc.networks.nokia.com" scope="external"
						>https://doc.networks.nokia.com</xref>
				</p>
			</note><p><b>Before you begin:</b></p>Before beginning this procedure, ensure the
				following:<ul id="ul_g4k_4yt_wmb">
				<li>
					<p>You know the hostnames of the VMs to heal.</p>
				</li>
				<li>
					<p>If you are healing a 1+1 VM, the VM must be in Standby mode.</p>
				</li>
				<li>
					<p>If you are healing an N+K VM , ensure that this VM is not taking any
						traffic.</p>
				</li>
			</ul><p>To manually heal the VM:</p></context><steps>
<step><cmd>Log in to the CBAM GUI.</cmd><info/></step>
<step><cmd>In the CBAM GUI, click the options button with three horizontal lines, and then select <b>Virtualized Network Functions</b>. The <b>Virtualized Network Functions</b> pane appears.</cmd><info/></step>
<step><cmd>In the <b>Virtualized Network Functions</b> pane, select the VNF  that you are going to heal and then click on the operations button with three vertical dots. The list of available operations appears.</cmd><info/></step>
<step><cmd>From the list of operations, click on <b>healone</b>. The <b>Healone</b> window appears.</cmd><info/></step>
<step><cmd>Find out the full name of the VM that needs healing and belongs to this VNF as follows:</cmd><info><ul>
<li>
<p>Find the VNF’s name in the VNF Extension file.</p>
</li>
<li>
<p>Using the VNF’s name, find the VM’s name in OpenStack Dashboard Horizon if your deployment is OpenStack, or in VMware vSphere if your deployment is VMware.</p>
</li>
</ul><p>For example, if the VM to heal is <i>diameterapp-0</i> and the following name-value pair is recorded in the VNF Extension file:</p><fig>
<codeblock>{
		"name": "vnf_name",
		"value": "SPS_IG_100"
},   </codeblock>
</fig><p>Then the VM name in OpenStack Dashboard is <i>SPS_IG_100-diameterapp-0</i>.</p></info></step>
<step><cmd>In the <b>Healone</b> window, configure <b>Additional Parameters</b> as follows:</cmd><info><ul>
<li>
<p>In the <b>vm_name </b>field, enter the VM’s name.</p>
</li>
<li>
<p>In the <b>force_start_vm</b> field, enter <i>no</i> unless the VM is unreachable. If the VM is
								unreachable, then <b>force_start_vm</b> must be set to <i>yes</i>. </p>
							<p>The force_start_vm is applicable to OpenStack deployments only and is
								not applicable for VMware environments.</p>
</li>
<li>
<p>In the <b>rebuild_vm</b> field, enter <i>no</i> to reboot the VM. To rebuild the VM enter <i>yes</i>.</p>
</li>
<li>
<p>Click <b>Finish</b>.</p>
</li>
</ul><p>
<b>Expected outcome</b>
</p><p>The <b>Healone</b> operation in CBAM succeeds or not.</p></info></step>
<step><cmd>If the <b>Healone</b> operation fails, do the following:</cmd><info><ul>
<li>
<p>If your deployment is OpenStack, and the <b>Healone</b> with rebuild fails, and the cause for the failure is that the "OS-EXT-STS:vm_state" is not set to "active", then you have to perform a "nova start &lt;instance ID&gt;" first and then perform the heal with rebuild.</p>
</li>
<li>
<p>If the <b>Healone</b> operation fails for any other reason or a particular VM repeatedly requires healing, contact your cloud administrator.</p>
</li>
</ul><note>
<p>It might occur that a VM gets healed successfully using this procedure but then right after manual healing this VM becomes unhealthy again. The time that elapses between the two events, healing and consecutive failing, might not be enough to reset the record of max_retry_times and allow auto-healing to schedule again. Thus, according to that record, the VM’s number of auto-heal attempts is still set to the old value showing that the number of auto-heal attempts is exhausted and therefore manual healing is still needed.</p>
<p>If this occurs, repeat this procedure. If the problem persists, contact Nokia Professional Services.</p>
</note></info></step>
</steps>
</taskbody></task>