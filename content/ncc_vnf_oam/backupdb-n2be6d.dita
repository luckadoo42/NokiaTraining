<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="id9yz-09126-mt00-rezza-sp2-backupdb-n2be6d"><title>db-backup tool</title><conbody>
<section><title>Description</title>
<p>This tool creates a backup copy of the NCC database so that it may be restored later if there are
                unforeseen situations (such as DB corruption or other severe scenarios) whereby the
                database needs to be restored back to a previous version.</p>
<p>Nightly backups can be achieved by scheduling db-backup to run on a scheduled interval (for example, each night during the maintenance window).</p>
<p>This tool is run on the active OAME node in the NCC system. Unless you are doing a disaster
                recovery, Nokia recommends that you perform this procedure during off hours
                (non-peak-hours). A separate backup file will be created for each namespace, with
                inline compression (gzip) performed as the file is created to reduce the amount of
                disk space required for these backups. All namespaces and data sets will be backed
                up.</p>
<p>The backup files can later be used as input to the db-restore tool.</p>
<note>
<p>db-backup will terminate if the cluster changes during the backup (for example, if a node goes down )</p>
</note>
<note>
<p>Do not run this command during the transition window from daylight saving time to standard time.</p>
</note>
</section>
<section><title>Syntax</title>
<codeblock>db-backup -d &lt;directory&gt; -n &lt;namespace[,namespace]*&gt; [-f] [-r &lt;local|both|all&gt;]</codeblock>
<table>
<tgroup cols="2">
<colspec colname="col1"/>
<colspec colname="col2"/>
<tbody>
<row>
<entry>
<b>Code</b>
</entry>
<entry>
<b>Description</b>
</entry>
</row>
<row>
<entry>
<codeblock>No arguments</codeblock>
</entry>
<entry>
Displays usage/help information
</entry>
</row>
<row>
<entry>
<codeblock>-h or -?</codeblock>
</entry>
<entry>
Displays usage/help information.
</entry>
</row>
<row>
<entry>
<codeblock>-d &lt;directory&gt;</codeblock>
</entry>
<entry>
Output directory for the backup files. This directory should already exist.
</entry>
</row>
<row>
<entry>
-f
</entry>
<entry>
Force execution. If specified, the user will not be asked for confirmation.
</entry>
</row>
<row>
<entry>
-n &lt;namespace[,namespace]*&gt;
</entry>
<entry>
Namespace list to backup. Allows you to specify the namespaces to backup.
</entry>
</row>
<row>
<entry>
-r &lt;local|both|all&gt;   
</entry>
<entry>
<p>Nodes running and storing the backups, where</p><ul>
<li>
<p>local: local OAME node</p>
</li>
<li>
<p>both: both OAME nodes</p>
</li>
<li>
<p> all: all database nodes</p>
</li>
</ul>
<p>If local, both, or all are not specified, the default is local.</p>
</entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section><title>Example Output </title>
<p>A summary output for this command using the “-r all” option is provided to the user.  Details of the backup operation can be found in the <b>backuplog</b> file, in the specified backup directory.</p>
<fig>
<codeblock>[tpaadmin@sps-me-1-oame-0 ~]$ db-backup -d /BACKUP/20190322 -r all
15:13  db-backup issued at: Fri Mar 22 15:13:36 EDT 2019
15:13  
15:13  Creating a database backup to [/BACKUP/20190322]

This action will create a backup of the local database in the directory:
/BACKUP/20190322

ATTENTION: The original database backup file will be removed if it exists.

Do you wish to continue? (y/n)y
15:13  Starting backup on sps-me-1-db-0 for sps-me-1-db-0-dsc
15:13  Starting backup on sps-me-1-db-1 for sps-me-1-db-1-dsc
15:13  Starting backup on sps-me-1-db-2 for sps-me-1-db-2-dsc
15:13  Starting backup on sps-me-1-db-3 for sps-me-1-db-3-dsc
15:13  Backup for sps-me-1-db-0-dsc completed
15:13  Backup for sps-me-1-db-2-dsc completed
15:13  Backup for sps-me-1-db-3-dsc completed
15:13  Backup for sps-me-1-db-1-dsc completed
15:13  Starting backup on sps-me-1-db-0 for sps-me-1-db-0-dsclocal
15:13  Starting backup on sps-me-1-db-1 for sps-me-1-db-1-dsclocal
15:13  Starting backup on sps-me-1-db-2 for sps-me-1-db-2-dsclocal
15:13  Starting backup on sps-me-1-db-3 for sps-me-1-db-3-dsclocal
15:13  Backup for sps-me-1-db-0-dsclocal completed
15:13  Backup for sps-me-1-db-2-dsclocal completed
15:13  Backup for sps-me-1-db-1-dsclocal completed
15:13  Backup for sps-me-1-db-3-dsclocal completed
15:13  Starting backup on sps-me-1-db-0 for sps-me-1-db-0-dscglobal
15:13  Starting backup on sps-me-1-db-1 for sps-me-1-db-1-dscglobal
15:13  Starting backup on sps-me-1-db-2 for sps-me-1-db-2-dscglobal
15:13  Starting backup on sps-me-1-db-3 for sps-me-1-db-3-dscglobal
15:13  Backup for sps-me-1-db-1-dscglobal completed
15:13  Backup for sps-me-1-db-2-dscglobal completed
15:13  Backup for sps-me-1-db-0-dscglobal completed
15:13  Starting backup on sps-me-1-db-0 for sps-me-1-db-0-spspd1
15:13  Starting backup on sps-me-1-db-1 for sps-me-1-db-1-spspd1
15:13  Starting backup on sps-me-1-db-2 for sps-me-1-db-2-spspd1
15:13  Backup for sps-me-1-db-3-dscglobal completed
15:13  Starting backup on sps-me-1-db-3 for sps-me-1-db-3-spspd1
15:13  Backup for sps-me-1-db-1-spspd1 completed
15:13  Backup for sps-me-1-db-0-spspd1 completed
15:13  Backup for sps-me-1-db-2-spspd1 completed
15:13  Backup for sps-me-1-db-3-spspd1 completed
15:13  
15:13  sps-me-1-db-0
15:13      dsc             Completed
15:13      dsclocal        Completed
15:13      dscglobal       Completed
15:13      spspd1          Completed
15:13  sps-me-1-db-1
15:13      dsc             Completed
15:13      dsclocal        Completed
15:13      dscglobal       Completed
15:13      spspd1          Completed
15:13  sps-me-1-db-2
15:13      dsc             Completed
15:13      dsclocal        Completed
15:13      dscglobal       Completed
15:13      spspd1          Completed
15:13  sps-me-1-db-3
15:13      dsc             Completed
15:13      dsclocal        Completed
15:13      dscglobal       Completed
15:13      spspd1          Completed
15:14  
15:14  SPS DB backup completed into directory [/BACKUP/20190322]
15:14  on the database nodes.
15:14  
15:14  See [/BACKUP/20190322/DB_BACKUP_*/*.backuplog] for
15:14  detailed output of backup command execution.
15:14  
15:14  db-backup completed at: Fri Mar 22 15:14:02 EDT 2019

</codeblock>
</fig>
</section>
</conbody></concept>